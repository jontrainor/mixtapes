{"version":3,"sources":["Playlist.js","App.js","index.js"],"names":["Playlist","props","playlist","react_default","a","createElement","name","title","src","concat","uri","split","width","height","frameborder","allowtransparency","allow","SPOTIFY_USER_ID","SPOTIFY_CLIENT_ID","COOKIE_NAME","App","_useState","useState","undefined","_useState2","Object","slicedToArray","accessToken","setAccessToken","_useState3","_useState4","fetchPlaylistsStatus","setFetchPlaylistsStatus","_useState5","_useState6","fetchPlaylistsChunkStatus","setFetchPlaylistsChunkStatus","_useState7","_useState8","fetchPlaylistOffset","setFetchPlaylistOffset","_useState9","_useState10","playlists","setPlaylists","useEffect","cookieAccessToken","cookie","get","spotifyApi","SpotifyWebApi","queryAccessToken","URLSearchParams","window","location","hash","slice","set","offset","playlistRegex","getUserPlaylists","limit","then","response","error","newPlaylists","items","filter","test","toConsumableArray","next","catch","status","remove","map","index","src_Playlist","renderFetchPlaylistState","onClick","encodedRedirectURI","encodeURI","process","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.13c1b1b5.chunk.js","sourcesContent":["import React from 'react';\n\nfunction Playlist(props) {\n  const getPlaylistId = (playlist) => {\n    // spotify:playlist:123asdf\n    const uriParts = playlist.uri.split(':')\n    return uriParts[2]\n  }\n\n  return (\n    <section>\n      <h2>{props.playlist.name}</h2>\n      <div>\n        <iframe\n          title={props.playlist.name}\n          src={`https://open.spotify.com/embed/playlist/${getPlaylistId(props.playlist)}`}\n          width=\"300\"\n          height=\"380\"\n          frameborder=\"0\"\n          allowtransparency=\"true\"\n          allow=\"encrypted-media\">\n        </iframe>\n      </div>\n    </section>\n  )\n}\n\nexport default Playlist;","import React, { useState, useEffect } from 'react';\nimport SpotifyWebApi from 'spotify-web-api-js';\nimport cookie from 'js-cookie'\nimport 'url-search-params-polyfill'\nimport Playlist from './Playlist'\nimport './App.css';\n\nconst SPOTIFY_USER_ID = 'jon.trainor';\nconst SPOTIFY_CLIENT_ID = '0b71959111884567b4530208b9f5add7';\nconst COOKIE_NAME = 'jontrainor-spotify-playlist';\n\nfunction App() {\n\n  const [accessToken, setAccessToken] = useState(undefined);\n  const [fetchPlaylistsStatus, setFetchPlaylistsStatus] = useState('NOT_ASKED');\n  const [fetchPlaylistsChunkStatus, setFetchPlaylistsChunkStatus] = useState('NOT_ASKED');\n  const [fetchPlaylistOffset, setFetchPlaylistOffset] = useState(0)\n  const [playlists, setPlaylists] = useState([])\n\n  // get and set auth token\n  useEffect(() => {\n    const cookieAccessToken = cookie.get(COOKIE_NAME)\n    const spotifyApi = new SpotifyWebApi()\n    const query = new URLSearchParams(window.location.hash.slice(1))\n    // if spotify authorization failed\n    // const queryError = query.get('error')\n    // const queryErrorState = query.get('state')\n\n    const queryAccessToken = query.get('access_token')\n    if(queryAccessToken) {\n      spotifyApi.setAccessToken(queryAccessToken)\n      setAccessToken(cookieAccessToken)\n      cookie.set(COOKIE_NAME, queryAccessToken)\n    } else if(cookieAccessToken) {\n      setAccessToken(cookieAccessToken)\n      spotifyApi.setAccessToken(cookieAccessToken)\n    }\n  }, [window.location.hash]);\n\n  // get playlists\n  useEffect(() => {\n    // ex: 06-19-2019\n    const playlistRegex = /^20\\d\\d\\.\\d\\d\\.\\d\\d$/\n\n    const getUserPlaylists = (offset) => {\n      const spotifyApi = new SpotifyWebApi()\n      return spotifyApi.getUserPlaylists(SPOTIFY_USER_ID, {\n        limit: 50,\n        offset,\n      })\n    }\n\n    if(accessToken && fetchPlaylistsChunkStatus !== 'PENDING' && fetchPlaylistOffset !== null) {\n      setFetchPlaylistsChunkStatus('PENDING')\n      setFetchPlaylistsStatus('PENDING')\n      getUserPlaylists(fetchPlaylistOffset).then((response, error) => {\n        if(error) {\n          setFetchPlaylistsChunkStatus('ERROR')\n          setFetchPlaylistsStatus('ERROR')\n        } else {\n          setFetchPlaylistsChunkStatus('SUCCESS')\n          const newPlaylists = response.items.filter((playlist) => {\n            return playlistRegex.test(playlist.name)\n          })\n          setPlaylists([...playlists, ...newPlaylists])\n\n          if(response.next) {\n            setFetchPlaylistOffset(fetchPlaylistOffset + response.limit)\n          } else {\n            setFetchPlaylistOffset(null)\n          setFetchPlaylistsStatus('SUCCESS')\n          }\n        }\n      }).catch((error) => {\n        // access token expired\n        if(error.status === 401) {\n          cookie.remove(COOKIE_NAME)\n          setAccessToken(undefined)\n          setFetchPlaylistsStatus('NOT_ASKED')\n        }\n      })\n    }\n  }, [SPOTIFY_USER_ID, accessToken, fetchPlaylistOffset])\n\n  const handleLoginClick = () => {\n    const encodedRedirectURI = encodeURI(process.env.REACT_APP_REDIRECT_URI)\n    window.location = `https://accounts.spotify.com/authorize?response_type=token&client_id=${SPOTIFY_CLIENT_ID}&redirect_uri=${encodedRedirectURI}`\n  }\n\n  const renderFetchPlaylistState = () => {\n    switch(fetchPlaylistsStatus) {\n      case 'NOT_ASKED' || 'PENDING':\n        return <div>loading</div>\n      case 'ERROR':\n        return <div>error</div>\n      case 'SUCCESS':\n        return (\n          <main>\n            <h1>Weekly Playlists</h1>\n            { playlists.map((playlist, index) => {\n              return (\n                <Playlist\n                  playlist={playlist}\n                />\n              )\n            })}\n          </main>\n        )\n      default:\n        return <noscript/>\n    }\n  }\n\n  return accessToken ? renderFetchPlaylistState() : (\n    <button onClick={handleLoginClick}>Log in to Spotify</button>\n  );\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n// import * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}